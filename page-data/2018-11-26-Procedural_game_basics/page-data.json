{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018-11-26-Procedural_game_basics/","result":{"data":{"markdownRemark":{"html":"<p>This past weekend I had some time to explore game development. City building is one of my favorite genres, so I looked into it and decided to experiment with a procedurally generated city. While there are a lot of basic tutorials out there, nothing really matched what I had in mind, so I got into the mathematics of procedural generation and game engine documentation. I choose to use the Unity game engine because of readily available documentation and ease of scripting with C#.</p>\n<p>As an aside, I also explored Unreal Engine, but most learning resources tended to use blueprints, which I found a bit cumbersome for this task; but the implementation tended to be the same: generate a grid or spline system. I will probably attempt a more thorough investigation at a later date.</p>\n<p>Note: I'm assuming a basic familiarity with Unity and will not go into details about Unity specific classes and functions.</p>\n<p>Some essential references from the Unity documentation:</p>\n<ul>\n<li><a href=\"https://docs.unity3d.com/Manual/InstantiatingPrefabs.html\">Instantiating Prefabs</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/GameObject.html\">Game Objects</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/Mathf.PerlinNoise.html\">Perlin Noise</a></li>\n</ul>\n<p>Credits for the 3D models used:</p>\n<ul>\n<li>Buildings/trees from <a href=\"https://assetstore.unity.com/packages/3d/poly-city-free-cartoon-pack-95242\">Poly City - Free Cartoon Pack</a> by <a href=\"https://assetstore.unity.com/publishers/26567\">Wand and Circles</a></li>\n<li>Roads from <a href=\"https://assetstore.unity.com/packages/3d/environments/urban/low-poly-street-pack-67475\">Low Poly Street Pack</a> by <a href=\"https://assetstore.unity.com/publishers/21977\">Dynamic Art</a></li>\n</ul>\n<hr>\n<h2>Method of Random Generation: Grids</h2>\n<p>First off, I'll briefly explain the reasoning behind the code.</p>\n<p>Just to mention it: one common approach is to randomly generate splines and attach objects to the spline, but this is a bit more complex and I didn't have the time to pursue that path.</p>\n<p>So while there are many approaches to take, the simplest one which I settled for was to generate a world grid then populate that grid with randomized elements. In terms of code, this involves generating a 2D array and populating it with random values.</p>\n<p>This is what it looks like:</p>\n<pre><code class=\"language-csharp\">// Generate City\nfor (int h = 0; h &#x3C; Height; h++)\n{\n  for(int w = 0; w &#x3C; Width; w++)\n  {\n    // ... Randomized Content ...\n  }\n}\n</code></pre>\n<h2>The Basic Grid and Assets</h2>\n<p>Using any assets, even geometric primitives such as cubes or spheres, an array of <code>GameObjects[]</code> can be created to use in populating the code. In my case I used some free assets I came across in the Unity Asset Store (see above) to make the screenshots look more interesting. When using imported assets, it is important to setup the scales to match the buildings and roads.</p>\n<p>Extrapolating from the basic grid structure discussed previously, a nested for-loop is used to generate the \"City Grid\".</p>\n<p>While this gives the basic grid pattern, everything will be placed on a single point rather than an area, so to overcome this, the generated instance <code>Vector3 pos</code> can be slightly enlarged with a spacing modifier. The value of this spacing depends on the relative scale of the assets and is fine tuned with trial and error.</p>\n<p>The code becomes as follows:</p>\n<pre><code class=\"language-csharp\">using UnityEngine;\nusing System.Collections;\n\npublic class buildCity : MonoBehaviour\n{\n    public GameObject[] cityAssets; // Array for building assets\n    public int citydWidth = 10;\n    public int citydHeight = 10;\n    public int citySpacing = 2; // Dependent on assets and scales\n\n    void Start ()\n    {\n        // City Grid\n        for (int h=0; h &#x3C; citydHeight; h++)\n        {\n            for (int w=0; w &#x3C; citydWidth; w++)\n            {\n                // Grid position to insert building asset\n                Vector3 pos = new Vector3(w * citySpacing, 0, h * citySpacing);\n                // Generating a random number from 0 to array length of cityAssets\n                int i = Random.Range(0, cityAssets.Length);\n                // Instantiating a randomly selected building from the cityAssets array\n                Instantiate(cityAssets[i], pos, Quaternion.identity);\n            }\n        }\n    }\n}\n</code></pre>\n<p>This yields the following:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee34ab1155d455786e5710647685c19d/29114/ProcCity01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.285714285714285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACNElEQVQoz42TWU/bQBRG87eqilalJQTHa+w4GwRK3BJoQGlQKUh9jxOQCNk3EIIs4omSTaJVYkL5X1/vTCFSxUP78OnOeOQz5/rKrkF/gJubHuUGw8EAo9EIw+EQt7c/MJ5M8PDwgJ9jB870Fya0d+7u4DgOxuMxz/39Pc90OsUdnbmMQABmeAWqPwBFNyHrfngVDaKiI7zyHlufd7GR3EU89RXWdhKpvX3Y6TQK+TyOj3NIp22c5HIol8soFIpwKZoO2adDUH1wezUsCBI8koZFUYUSjCB28A3LyRQiyQP445tIfNmDbdv0cgGVahUn+QIOj45QKhVRrlTh0vwhAgYgKAYWJRkLXpFgCtwigWUNoUQC4Z19mNY2lPUEYokUMpkMAco4PT1Fs9lEvV7nYWuXEQxBoXaZoUdWyFAlUwnvBAEeQYZX9UKMrEFdjcOjBbEaiyObzfIWG43Gs7jM8DL0UBCSzyBLjdr1YYnMlqjqBApt7EBSNQiSilfzblgf42Roo1gsciMGeTKcAQ0CqmaAbAimyBSq9B3FYBRabAsvX7/F3Bs3XszNYy32ARn7D5C1/AwYXbewalkIR9cQiEThM0M8qmFyq4VFAW5qnV3A6sbmJxpKmk+0SkOp1WozKAdWKhU6qOH8/BytVmuWy8vHdbv91/M27Vk6nQ7fP9nNgGdnZ1z/6uoK/X4fvV7vn2E/AavX19/RfGx7NhSmzegXFxf81v9Nt9vlpuz9UqnEp87yG3KFLCqhN5NEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"city grid setup\"\n        title=\"city grid setup\"\n        src=\"/static/ee34ab1155d455786e5710647685c19d/8c557/ProcCity01.png\"\n        srcset=\"/static/ee34ab1155d455786e5710647685c19d/4edbd/ProcCity01.png 175w,\n/static/ee34ab1155d455786e5710647685c19d/13ae7/ProcCity01.png 350w,\n/static/ee34ab1155d455786e5710647685c19d/8c557/ProcCity01.png 700w,\n/static/ee34ab1155d455786e5710647685c19d/e996b/ProcCity01.png 1050w,\n/static/ee34ab1155d455786e5710647685c19d/2cefc/ProcCity01.png 1400w,\n/static/ee34ab1155d455786e5710647685c19d/29114/ProcCity01.png 1920w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Adding Random Noise</h2>\n<p>The above code produces a basic randomized grid city, but it is too random... Real cities have some kind of plan and designated zones for low and high rise areas as well as parks. So to emulate this, I added noise to the generated blocks. (I found a good tutorial about noise <a href=\"https://catlikecoding.com/unity/tutorials/noise/\">here</a>, but it was more for textures than anything else.)</p>\n<p>There are several approaches to doing this including making your own custom noise function using the <code>Random</code> class of C#. However, to save time, I've used the Unity built-in function for Perlin noise, part of the Mathf struct: <code>Mathf.PerlinNoise</code>. My information was found from the <a href=\"https://docs.unity3d.com/ScriptReference/Mathf.PerlinNoise.html\">Unity documentation</a> and Wikipedia for a more general discussion of <a href=\"https://en.wikipedia.org/wiki/Perlin_noise\">Perlin Noise</a>. The Perlin Noise function essentially acts as a height map of sorts where a higher value corresponds to a more \"dense\" (in the urban sense- higher buildings) than a lower value.</p>\n<p>The <code>PerlinNoise()</code> function takes two inputs: an x and y coordinate. For my use case, this is the grid coordinates of the city (width and height). Upon first use, I didn't find any variation because, as I read later, large input values produce a constant result for the Perlin Noise function. Through some trial and error, I found that the key was to make the input values of width and height small enough that a noticeable variation is achieved in the topography of the city. The sweet spot was dividing the with and height by 10 to achieve the desired results.</p>\n<p>The Perlin Noise function results are <code>float</code> types by default and in order to make the divisions easier to work with, I multiply by a factor of 10 and cast the result to an <code>int</code> type. This does cause a great deal of truncation, but I do not see it being a factor for the city grid generation because a city is rendered on a very large scale. Where truncation might be an issue is for generation smaller scale or precision work such as textures generation.</p>\n<p>Following the setup of the <code>PerlinNoise()</code> function, the variation steps of the function results need to be segregated such that a \"zoned\" city will appear when simulated. Although I'm sure this can be achieved programmatically, due to the limited time I simply manually tuned the parameter by running the output in the Unity Engine console:</p>\n<pre><code class=\"language-csharp\">Debug.Log(\"Perlin Noise Result = \" + resultNoise.ToString());\n</code></pre>\n<p>From the console output, I selected my divisions and choose my assets accordingly.</p>\n<p>The final code with noise was as follows:</p>\n<pre><code class=\"language-csharp\">using System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\npublic class cityGridNoise : MonoBehaviour\n{\n    public GameObject[] cityAssets; // Array for building assets\n    public int citydWidth = 20;\n    public int citydHeight = 20;\n    public int citySpacing = 2; // Dependent on assets and scales\n\n    void Start()\n    {\n        // City Grid\n        for (int h = 0; h &#x3C; citydHeight; h++)\n        {\n            for (int w = 0; w &#x3C; citydWidth; w++)\n            {\n                // Multiply result by 10 for easier zoning divisions\n                int resultNoise = (int)(Mathf.PerlinNoise(w / 10.0f, h / 10.0f) * 10);\n                Vector3 pos = new Vector3(w * citySpacing, 0, h * citySpacing);\n\n                // Divide noise results into specific assets to achieve 'city zoning' effect\n                if (resultNoise &#x3C; 1)\n                {\n                    Instantiate(cityAssets[0], pos, Quaternion.identity);\n                }\n                else if (resultNoise &#x3C; 2)\n                {\n                    Instantiate(cityAssets[1], pos, Quaternion.identity);\n                }\n                else if (resultNoise &#x3C; 3)\n                {\n                    Instantiate(cityAssets[2], pos, Quaternion.identity);\n                }\n                else if (resultNoise &#x3C; 4)\n                {\n                    Instantiate(cityAssets[3], pos, Quaternion.identity);\n                }\n            }\n        }\n    }\n}\n</code></pre>\n<p>The city should now display with a zoning-like effect:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fdef94bfe44bc8954b161a2f263d2a27/29114/ProcCity02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.285714285714285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACQElEQVQoz42Ty08aURTG58/qojHRlIcz44zjvAAHK0jR0VpaKU1s90DcVGBAQB7hpQsXVQJNTEp56P/19dxLcNGVi1/OOXPvfPc798wIo9EIDw8PxBAsH4/HxG88Pj5iMpng6fkJfyZ/MZ0/YzqlOJtiNp3yNcZiseDM53PMZjMIZigCMxyFumNCM2xsE6IqQTND2I3GcZRK4/BzBm76DImPX5D+do5cLodisYifl5fI5fO4pFgul1EqeRCWIiEEJQVBWUNQ0eCTRYiKDsVyED87x3sS2nWPoMdcnH79jnwui0KhiGq1ikKxRHkBtVoN1Vp9KajqJrnSESBRUTUIGxu+IGTNwIF7jFAkCsOK0D4bqXSGBHPwvDJarRa8UglFz0O5UkG73Yag28uNIjkLyioC5FLcNklcwya5tOMniB6nEU5+grJjwD05xcXFBa6urtBoNKjNEm+fOWS1YO86MMiBrNmQNGpdJWF1E4EtGboTg+lmYKV+QEumsBGUEU8kuWCFHF1fX3PqJMYEWS7YTgRWdA874RgUM0qi5FbT4Jd8kGwHavwYa34Ja+vv8ObtOvYPksjTIDxqs9lsvoiuEPZiCewnDuHEPsB29qFbIT51K7IHiQ0oIMJPzja36BBRwaF7gmw2y9tkQ1k5q9frS0F2F+xhp9NBv9/n9Ho9Dq8HA4qDl7UB1YybmxteM6EVXJBNit3H3d0dhsPhq2A/Aou/7u/R+K9tgdlmSbfb5Seyk1/D7e0td8reZx81M8X4B0gYLVUm1u8PAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"zoning effect\"\n        title=\"zoning effect\"\n        src=\"/static/fdef94bfe44bc8954b161a2f263d2a27/8c557/ProcCity02.png\"\n        srcset=\"/static/fdef94bfe44bc8954b161a2f263d2a27/4edbd/ProcCity02.png 175w,\n/static/fdef94bfe44bc8954b161a2f263d2a27/13ae7/ProcCity02.png 350w,\n/static/fdef94bfe44bc8954b161a2f263d2a27/8c557/ProcCity02.png 700w,\n/static/fdef94bfe44bc8954b161a2f263d2a27/e996b/ProcCity02.png 1050w,\n/static/fdef94bfe44bc8954b161a2f263d2a27/2cefc/ProcCity02.png 1400w,\n/static/fdef94bfe44bc8954b161a2f263d2a27/29114/ProcCity02.png 1920w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Adding roads</h2>\n<p>The next challenge was adding roads. I spent a lot of time thinking about this. How do I possibly get roads to align with buildings when each point is randomly assigned? I first tried to mess around with the aforementioned Perlin Noise result divisions/zoning, but wound up with non-sensical spaghetti roads.</p>\n<p>How not to make roads:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bceaaacd1e30a0699756f35f996aaa4b/29114/ProcCity03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.285714285714285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACMklEQVQoz42S604aQRiG97L6o2kTDbiAwAKyB5bjAmo8xzZeglY5BJbzQbyGkkpTgwU0va6nM2sxbfqj/fFmZvPNvt/zvTPK/Zd7pp+nTKdT5P5+NmM2+8q3hwceHx95fn5m/n3JYvWDxWLBcrn0Vlmbz+esViuenp68VdaUdM4hW3DIOUWK5TKpXA49VyBbcjg5P+Hg4wd2T47YOz8lf3zE2cUFn66ucF2XRrNJpXJDo9Gg0+nQarVRoqZNwjSx7DSpTBorbWBnbfJOlkI5j1WysMr7GOVj4lmHw7NDqpWqZ9Dv93GFSbVaZTAY0O31URLJGEnDwEpZmLaOlTEpFB1Ku3uiQYKIGUYrloT2hPIcnJapVesMh0PGt7e0221a7Q5t0WAymaBowiys60IGyVRSkOqkcxaZQpqobqIGAmypftSgyqZ/04ulVqt5ROPx2Bu96bboCdq7uzuUoG4TiccJJzT8CYOgnhGUwjRrsmPtCKMAwVCQ4HaIDZ9fkO9Tr78QjkYjut0eHUHY6/UYim9lKxQiFNHQ4jF8kTBqLI5hJohK8qSJz+/j/aaPdxs+3rzdIF8si4uoePlJQilpvJaiCarYjhjXlBmmyIgLSWctNDsj8ssT2I6ihjTRNI4q9vsHR56hJJJjS9K1PEPXbXoZ1BtN0XXgYb8c+PPwWr+byL3U6Nc/nuHN9TWX1zUuK3VR7P81wr+0Nnod+Uo80kqtjiuCXXf8X8mx5Xvsdruv+gk7kiW1c9L20QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bad road initialization\"\n        title=\"bad road initialization\"\n        src=\"/static/bceaaacd1e30a0699756f35f996aaa4b/8c557/ProcCity03.png\"\n        srcset=\"/static/bceaaacd1e30a0699756f35f996aaa4b/4edbd/ProcCity03.png 175w,\n/static/bceaaacd1e30a0699756f35f996aaa4b/13ae7/ProcCity03.png 350w,\n/static/bceaaacd1e30a0699756f35f996aaa4b/8c557/ProcCity03.png 700w,\n/static/bceaaacd1e30a0699756f35f996aaa4b/e996b/ProcCity03.png 1050w,\n/static/bceaaacd1e30a0699756f35f996aaa4b/2cefc/ProcCity03.png 1400w,\n/static/bceaaacd1e30a0699756f35f996aaa4b/29114/ProcCity03.png 1920w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Upon looking at my grid, and Google Maps, I realized I needed a grid within a grid: Gridception!\nSo the easiest way I could think of was to generate the Perlin Noise in a 2D array then modify that array in certain rows and columns to have indicators for roads.</p>\n<p>This took a bit of exploring 2D arrays in C#:</p>\n<ol>\n<li>First, an array of random integers was created to emulate the results from the Perlin Noise function.</li>\n<li>Then rows at fixed intervals were modified to represent streets in the horizontal direction of the city grid, taking a value of \"-\".</li>\n<li>Finally, columns along the city grid were modified to represent streets in the vertical direction, taking value of \"|\" nominally, or if a horizontal direction was detected then modifying it to a \"+\" to represent an intersection.</li>\n</ol>\n<p>Here is the very simple array manipulation C# script (non-Unity; generic C# .NET console application in VisualStudio):</p>\n<pre><code class=\"language-csharp\">using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\n\nnamespace csArrayManip\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string[,] arr = new string[10, 10]; // Initialize a string array\n            Random rnd = new Random(); // Initialize a Random type variable\n\n            int rowLength = arr.GetLength(0);\n            int colLength = arr.GetLength(1);\n\n            for (int i = 0; i &#x3C; rowLength; i++)\n            {\n                for (int j = 0; j &#x3C; colLength; j++)\n                {\n                    // Generate random numbers as strings to populate the array\n                    arr[i, j] = rnd.Next(1, 6).ToString();\n                }\n            }\n\n            Console.Write(string.Format(\"Original Array:\") + Environment.NewLine);\n            Print2DArray(arr);\n\n            // Modify the Row-direction\n            int row = 0;\n            for (int i = 0; i &#x3C; rowLength; i++)\n            {\n                for (int j = 0; j &#x3C; colLength; j++)\n                {\n                    arr[row, j] = \"-\";\n                }\n                // Increment to another row at random intervals within the range\n                row += rnd.Next(3, 4);\n                if (row >= rowLength) break;\n            }\n\n            Console.Write(string.Format(\"Row-Modified Array:\") + Environment.NewLine);\n            Print2DArray(arr);\n\n            // Modify the Column-direction\n            int col = 0;\n            for (int i = 0; i &#x3C; rowLength; i++)\n            {\n                for (int j = 0; j &#x3C; colLength; j++)\n                {\n                    // Checks if previously assigned \"-\" value\n                    if (arr[j, col] == \"-\")\n                    {\n                        // If true, an \"intersection\" is created as value \"+\"\n                        arr[j, col] = \"+\";\n                    }\n                    else\n                    {\n                        // Otherwise, create a column value of \"|\" (pipe)\n                        arr[j, col] = \"|\";\n                    }\n                }\n                // Increment to another column at random intervals within the range\n                col += rnd.Next(4, 8);\n                if (col >= colLength) break;\n            }\n\n            Console.Write(string.Format(\"Column-Modified Array:\") + Environment.NewLine);\n            Print2DArray(arr);\n\n            Console.ReadLine();\n        }\n\n        /// Prints out a 2D array.\n        public static void Print2DArray&#x3C;ary>(ary[,] arg)\n        {\n            int rowLength = arg.GetLength(0);\n            int colLength = arg.GetLength(1);\n\n            for (int i = 0; i &#x3C; rowLength; i++)\n            {\n                for (int j = 0; j &#x3C; colLength; j++)\n                {\n                    Console.Write(arg[i, j] + \"\\t\");\n                }\n                Console.Write(Environment.NewLine);\n            }\n            Console.Write(Environment.NewLine);\n        }\n    }\n}\n</code></pre>\n<p>Here is the output of the console application:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 646px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d62a04b62f58a40f508b9bf0213a61d7/27524/ProcCity04.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.71428571428571%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByUlEQVQ4y51U227CMAxNb2kp0BYKmoRgEi8gbW/s/79igkK5awMh2D94cahLWtKN7SE6xI5Pjn1IWfpxhM1uD+l6C8vNFpLFEpJ0BdNkIddsnsJ8uYb3aSJwBbNFKuKpjK82OzhdvuBwOsP+8wDH8wXY+OUVBv0+PA8G0Ov1oNWKIApDiNttiZ04hiiK5D4MwgwDiDEu8t1OR54JROxtMgFmux4wxvJlWaZE27YLaFmWNm6aZl47HA6B1cNIBl3XlUWcczAMAzyxR8Q45Q3jiljsed71nEAiH4/HwGqNpkwgkSkIHceRSSrk3M3zjFDJkxD8PRqNMkKxQSJDKFEJywoZMwpElYSWKMCbLUUhIbaDxOpeRYzTHCVhu/skXQuy5ft+waRHFl6Yz9CrNwpK6GY3M4e7ygzZ/Qyps1whEhoZIUonQl5qWdeqtmW3gtBxboU5oULsZEqprqCwoCSTrypQTdFhgdDxatd/vCDCQhowHXoE71xGd0PxLgOxms1mPvD/uSxfCrZ8lU6tyCdImLeMLt/y1PJjLisFN5d1s+T3puhdVpTqXK4yRSXEr8mPhKW4lpDX/JJrepdpTr+6bDr8z2+3ymUk/AaJntq0UVlN2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"grid console output\"\n        title=\"grid console output\"\n        src=\"/static/d62a04b62f58a40f508b9bf0213a61d7/27524/ProcCity04.png\"\n        srcset=\"/static/d62a04b62f58a40f508b9bf0213a61d7/4edbd/ProcCity04.png 175w,\n/static/d62a04b62f58a40f508b9bf0213a61d7/13ae7/ProcCity04.png 350w,\n/static/d62a04b62f58a40f508b9bf0213a61d7/27524/ProcCity04.png 646w\"\n        sizes=\"(max-width: 646px) 100vw, 646px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>]</p>\n<p>Getting back to Unity, the previous array manipulation was implemented purely with integers because it is far easier to quickly manipulate than strings. Instead of dashes, pipes and pluses, negative numbers outside the range of the Perlin Noise result function were used.</p>\n<p>After some refactoring, the summary of changes are as follows:</p>\n<ul>\n<li>Added 3 new <code>GameObjects</code>: X-Direction Roads, Z-Direction Roads and Intersections</li>\n<li>Added a City Grid 2D array of integers to store initial Perlin Noise function results</li>\n<li>Added modifier methods to add roads in X and Z directions or intersections</li>\n<li>City generation refactored to an asset assignment method</li>\n</ul>\n<p>The complete refactored and final Unity script now looks like this:</p>\n<pre><code class=\"language-csharp\">using System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\npublic class cityGridNoiseRoads : MonoBehaviour\n{\n    public GameObject[] cityAssets;\n    public GameObject xDirRoad;\n    public GameObject zDirRoad;\n    public GameObject intersection;\n\n    public int cityWidth = 20;\n    public int cityHeight = 20;\n    public int citySpacing = 2; // Dependent on assets and scales\n\n    int[,] cityGrid;\n\n    void Start()\n    {\n        cityGrid = new int[cityWidth, cityHeight];\n\n        // Generate Initial Layout\n        for (int h = 0; h &#x3C; cityHeight; h++)\n        {\n            for (int w = 0; w &#x3C; cityWidth; w++)\n            {\n              // Add some random variation to the Perlin Noise generation\n              wRand = w + Random.Range(0, 3);\n              hRand = h + Random.Range(0, 3);\n\n              // Generate the Perlin Noise value for a point on the grid\n              cityGrid[w, h] = (int)(Mathf.PerlinNoise(wRand / 10.0f, hRand / 10.0f) * 10);\n            }\n        }\n\n        // Modify Grid Layout to Add Roads in Rows (Unity Z-direction)\n        int row = 0;\n        // Note that the Height and Width are reversed to call rows in order\n        for (int w = 0; w &#x3C; cityWidth; w++)\n        {\n            for (int h = 0; h &#x3C; cityHeight; h++)\n            {\n                // Assign a z-direction road\n                cityGrid[row, h] = -1;\n            }\n            // Increment to another row at random intervals within the range\n            row += Random.Range(3, 4);\n            if (row >= cityWidth) break;\n        }\n\n        // Modify Grid Layout to Add Roads in Columns (Unity X-Direction)\n        int col = 0;\n        for (int h = 0; h &#x3C; cityHeight; h++)\n        {\n            for (int w = 0; w &#x3C; cityWidth; w++)\n            {\n                //Check if previously assigned z-direction road exists\n                if (cityGrid[w, col] == -1)\n                {\n                    // If ture, assign an intersection\n                    cityGrid[w, col] = 0;\n                }\n                else\n                {\n                    // Otherwise, assign a x-directon road\n                    cityGrid[w, col] = -2;\n                }\n            }\n            // Increment to another column at random intervals within the range\n            col += Random.Range(4, 8);\n            if (col >= cityHeight) break;\n        }\n\n        // Generate City\n        for (int h = 0; h &#x3C; cityHeight; h++)\n        {\n            for (int w = 0; w &#x3C; cityWidth; w++)\n            {\n                int assetAssign = cityGrid[w, h];\n                Vector3 pos = new Vector3(w * citySpacing, 0, h * citySpacing);\n\n                if (assetAssign == 0)\n                {\n                    // Display an intersection\n                    Instantiate(intersection, pos, intersection.transform.rotation);\n                }\n                else if (assetAssign == -1)\n                {\n                    // Display a Z-direction road\n                    Instantiate(zDirRoad, pos, zDirRoad.transform.rotation);\n                }\n                else if (assetAssign == -2)\n                {\n                    // Display a X-direction road\n                    Instantiate(xDirRoad, pos, xDirRoad.transform.rotation);\n                }\n                // All other cityAssets below\n                else if (assetAssign &#x3C;= 2)\n                {\n                    Instantiate(cityAssets[0], pos, Quaternion.identity);\n                }\n                else if (assetAssign &#x3C;= 4)\n                {\n                    Instantiate(cityAssets[1], pos, Quaternion.identity);\n                }\n                else if (assetAssign &#x3C;= 6)\n                {\n                    Instantiate(cityAssets[2], pos, Quaternion.identity);\n                }\n                else if (assetAssign &#x3C;= 8)\n                {\n                    Instantiate(cityAssets[3], pos, Quaternion.identity);\n                }\n            }\n        }\n\n        // Unity debug console output to test visual asset correlation with generated grid\n        string arrStr = \"\";\n        for (int i = 0; i &#x3C; cityHeight; i++)\n        {\n            for (int j = 0; j &#x3C; cityWidth; j++)\n            {\n                arrStr += string.Format(cityGrid[i, j] + \"\\t\");\n            }\n            arrStr += System.Environment.NewLine + System.Environment.NewLine;\n        }\n        Debug.Log(arrStr);\n\n    }\n}\n</code></pre>\n<p>This script now generates this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ce27d0e4f78f57ce1258b04ee7cb2f3/29114/ProcCity05.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.285714285714285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACgklEQVQoz12T7U/aUBjF+cOWiEsQhPZSCuVVwbghvmxGs5fEbLrFxKkMEQSqUtBsiaD7sIhAXLIp4tzf9dtt1SzZh5PznKftuefe+9TV7XbpnHfodDr0ej36vT79fp8fl5cMBgN+393x82rA4PYP11Lf3NwwvBlwffWLK4nb26HELcPh0HnmiicT6EYUPaxjxGIIPYQWEcSTE6TSz5hfXCb3YpHcyyWy84ssv1lhYzPPbrlGYbfC5tY25VIJ0zSpVKu49HAEv6rgVxSEFkIYIbyqV/ZCBI0kydwSybkccYlgaoaFV+9Y366yXWpSNL9SKlfY2SlQq9Uw9w9whSI6mq4RCGooQkWPpfD4Be7RUaJTWSZnF9CTacKpNO5gkvm3axQLeQ72TY6bDaoy1V6lSkXiqHlkG4YJCIHXH2A8ECBkJPAHdTw+VWqFTCZNMCgIRyJyYZ3pmXmZaEcmMmk0muyVy5QrFZlun+PjY1xGIs64qqHqUbxKiDHhk7UNjRH3KNrULNnXK6jqOEpQZXZulkKhwL40sKyGw4eHh9K8QbPZlJcyEUMzDCKJjEwWQUQMfMKLR3HjUwUeeb56PMaY18OTkVGmszk+5/PSyJQGDcfIsiyset1hVyyVIjGZJpHJEoqmMOIThOMptGgcLRxFCEUeh2AsoPPUJ3ieW2Dj0xalvSo188BJZxvVHw1X819YL3/j4+4Zaztt3hdOHP5QPJNos1Y8ZbXQkr1HtJ3+4/t7tToNq/7P8LzTxcH5BZ0LOeSytvm8c/HAtu498L2+6Pboyh/gu/zmsG5JQ+t+27Zhq3VCu93ikdut1oO+r1v/aRunp23Ozk6dvn0pzgzKwbbxF96UKOp6H5A+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"final zoned grid\"\n        title=\"final zoned grid\"\n        src=\"/static/4ce27d0e4f78f57ce1258b04ee7cb2f3/8c557/ProcCity05.png\"\n        srcset=\"/static/4ce27d0e4f78f57ce1258b04ee7cb2f3/4edbd/ProcCity05.png 175w,\n/static/4ce27d0e4f78f57ce1258b04ee7cb2f3/13ae7/ProcCity05.png 350w,\n/static/4ce27d0e4f78f57ce1258b04ee7cb2f3/8c557/ProcCity05.png 700w,\n/static/4ce27d0e4f78f57ce1258b04ee7cb2f3/e996b/ProcCity05.png 1050w,\n/static/4ce27d0e4f78f57ce1258b04ee7cb2f3/2cefc/ProcCity05.png 1400w,\n/static/4ce27d0e4f78f57ce1258b04ee7cb2f3/29114/ProcCity05.png 1920w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>A debug log was added for reference. Note the correlation between the Z-axis (blue arrow) and X-axis (red arrow).</p>\n<p>And that wraps up this fun little weekend adventure!</p>","frontmatter":{"date":"November 26, 2018","title":"Procedural City Game Basics","tags":["game development","procedural generation","Unity","C#"]}}},"pageContext":{"slug":"/2018-11-26-Procedural_game_basics/"}},"staticQueryHashes":["63159454"]}