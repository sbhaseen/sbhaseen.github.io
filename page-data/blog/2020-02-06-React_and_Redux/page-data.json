{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2020-02-06-React_and_Redux/","result":{"data":{"markdownRemark":{"html":"<p>React on it's own is a fairly strightforward library to use once you understand the basics of components and state. What becomes challenging is using global authentication and global state.</p>\n<p>I decided to make a full stack MERN applicaiton to learng how to implement Redux in a realistic scenario. MERN breaks down into: MongoDB, Express.js, React and Node.js.</p>\n<p>In essence, Redux was used to create a globally accessible store which would contain high-level state for things such as authentication.</p>\n<h3>Retrospective</h3>\n<p>This project was done at a time when I first started learing about <a href=\"https://reactjs.org/docs/hooks-intro.html\">React Hooks</a>, therefore I decided to stick with the then-familar class components and methods.</p>\n<p>If I were to redo this now, I would almost exclusively rely on Hooks and functional components which would possibly simplify some of the logic and maybe eliminate the need for Redux. I would employ things like <code>useReducer</code>, <code>useEffect</code>, <code>useState</code> and <code>useCallback</code> or <code>useMemo</code>.</p>\n<hr>\n<h2>Project Structure</h2>\n<p>I broke down the project into two distict parts:</p>\n<ul>\n<li>A back end server</li>\n<li>A front end client</li>\n</ul>\n<p>This is also how the Git repositories are structured. The main reason behind this is to allow the Node.js dependencies to remain isolated and simplify any troubleshoting to resolve breaking changes down the line.</p>\n<p>The GitHub repos can be found here:</p>\n<ul>\n<li><a href=\"https://github.com/sbhaseen/mern-item-list-backend\">Express.js REST API Server (back-end)</a></li>\n<li><a href=\"https://github.com/sbhaseen/mern-item-list-frontend\">React client (front-end)</a></li>\n</ul>\n<h2>Express.js REST API Server</h2>\n<p>I started with the server development first, as I find it best to structure my data so that it is well defined for client-side fetching.</p>\n<p>The data I want to save consisted of Items for the To Do list and then Users who would have access to edit the items.</p>\n<p>This resulted in the creation of Mongoose models as interfaces to the MongoDB instance.</p>\n<p><code>Items</code> is quite simple:</p>\n<pre><code class=\"language-js\">const mongoose = require(\"mongoose\")\nconst Schema = mongoose.Schema\n\nconst ItemSchema = new Schema({\n  description: { type: String, required: true },\n  responsible: { type: String },\n  priority: { type: String },\n  completed: { type: Boolean, default: false },\n})\n\nmodule.exports = mongoose.model(\"Item\", ItemSchema)\n</code></pre>\n<p><code>Users</code> is a bit more involved becuase I decided to add helper methods to encrypt the passwords while saving.</p>\n<pre><code class=\"language-js\">const mongoose = require(\"mongoose\")\nconst Schema = mongoose.Schema\nconst { hashHelper, compareHelper } = require(\"../utilities/bcrypt-helper\")\n\nconst UserSchema = new Schema({\n  name: { type: String, required: true },\n  email: { type: String, required: true, unique: true },\n  password: { type: String, required: true },\n})\n\nUserSchema.pre(\"save\", async function (next) {\n  if (!this.isModified(\"password\")) return next()\n  // Important: Must await hash result before assignment or else plain text is saved\n  const hashedPassword = await hashHelper(this.password)\n  this.password = hashedPassword\n})\n\nUserSchema.methods.verifyPassword = function (inputPassword) {\n  return compareHelper(inputPassword, this.password)\n}\n\nmodule.exports = mongoose.model(\"User\", UserSchema)\n</code></pre>\n<p>The helper functions invoke <code>bcrypt.hash()</code> and <code>bcrypt.compare()</code>, where <code>.hash()</code> also calls the <code>bcrytp.genSalt()</code> method.</p>\n<p>More details can be found in the self-documented JSDoc format within the GitHub repo.</p>\n<p>Finally, to access the endpoints which could perform database operations, threee distinct paths were chosen:</p>\n<ul>\n<li>\n<p>Auth: <code>/api/auth</code></p>\n<ul>\n<li>This endpoint handles the authentication actions.</li>\n</ul>\n</li>\n<li>\n<p>Users: <code>/api/users</code></p>\n<ul>\n<li>This endpoint handles the creating a new user. It uses the data model of User.js.</li>\n</ul>\n</li>\n<li>\n<p>Items: <code>/api/items</code></p>\n<ul>\n<li>This endpoint handles creating, reading, updating and deleting Items in a collection. It uses the data model of Item.js.</li>\n</ul>\n</li>\n</ul>\n<p>Pagination (custom middleware function):</p>\n<p>Pagination is used to limit a potential response delay and very large data set by serving only small chunks of Item data at a time.</p>\n<p>The optional URL parameters are page and limit, where page is the current page to be views and limit is the maximum number of items shown on a page.</p>\n<ul>\n<li>Example: <code>https://localhost:5000/api/items?page=2&#x26;limit=10</code></li>\n<li>\n<p>The function returns pagination navigation information:</p>\n<ul>\n<li><code>next</code> for next page</li>\n<li><code>previous</code> for previous page</li>\n<li><code>total</code> an object containing the total items and total pages for the data set</li>\n<li>\n<p>Default values are:</p>\n<pre><code>page = 1;\nlimit = 5;\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p>I started with naive testing in Postman to verify things were wired correctly, then moved to write a few small model and endpoint tests using Jest.</p>\n<h2>React Client</h2>\n<p>On the front end, the major work was implementing the Redux <code>actions</code>, <code>reducers</code> and <code>store</code>.</p>\n<p>The Axios library was used to query API endpoints as it simplified some of the logic compared to the built-in fetch method.</p>\n<p>Actions perfrom an actions such as GET, PUT, DELETE, etc. and dispatch a \"signal\" function to a reducer that will typically contain the action type and payload.</p>\n<p>The reducer then acts on the action type and sets the state in the store according to the payload data.</p>\n<p>It would be too long to list all the action methods here, but I'll show the basic <code>action types</code>, the <code>item actions</code> and the associated <code>item reducer</code>. The rest can be found in the <code>src/redux/actions</code> folder, with JSDoc comments.</p>\n<p>Actions Types:</p>\n<pre><code class=\"language-js\">export const GET_ITEMS = \"GET_ITEMS\"\nexport const ADD_ITEM = \"ADD_ITEM\"\nexport const ADD_ITEM_PRELOAD = \"ADD_ITEM_PRELOAD\"\nexport const DELETE_ITEM = \"DELETE_ITEM\"\nexport const ITEMS_LOADING = \"ITEMS_LOADING\"\nexport const ITEMS_ERROR = \"ITEMS_ERROR\"\n\nexport const USER_LOADING = \"USER_LOADING\"\nexport const USER_LOADED = \"USER_LOADED\"\n\nexport const AUTH_ERROR = \"AUTH_ERROR\"\nexport const LOGIN_SUCCESS = \"LOGIN_SUCCESS\"\nexport const LOGIN_FAIL = \"LOGIN_FAIL\"\nexport const LOGOUT_SUCCESS = \"LOGOUT_SUCCESS\"\nexport const REGISTER_SUCCESS = \"REGISTER_SUCCESS\"\nexport const REGISTER_FAIL = \"REGISTER_FAIL\"\n\nexport const GET_ERRORS = \"GET_ERRORS\"\nexport const CLEAR_ERRORS = \"CLEAR_ERRORS\"\n\nexport const GET_NEXT_PAGE = \"GET_NEXT_PAGE\"\nexport const GET_PREV_PAGE = \"GET_PREV_PAGE\"\nexport const SET_PAGE_ITEM_LIMIT = \"SET_PAGE_ITEM_LIMIT\"\n</code></pre>\n<p>Item Actions (queries the <code>/api/items/</code> endpoints):</p>\n<pre><code class=\"language-js\">import axios from \"axios\"\nimport {\n  GET_ITEMS,\n  ITEMS_LOADING,\n  ADD_ITEM,\n  ADD_ITEM_PRELOAD,\n  DELETE_ITEM,\n  ITEMS_ERROR,\n} from \"./actionTypes\"\nimport { returnErrors } from \"./errorActions\"\nimport { headerConfig } from \"./authActions\"\nimport api from \"../../api\"\n\n/**\n * Handle fetching item data from the api.\n */\nexport function getItems(fetchPage, fetchLimit) {\n  return dispatch => {\n    let params = new URLSearchParams()\n    params.append(\"page\", fetchPage)\n    params.append(\"limit\", fetchLimit)\n\n    const getUrl = api.getAllItems + params\n\n    dispatch(setItemsLoading())\n\n    return axios\n      .get(getUrl)\n      .then(res =>\n        dispatch({\n          type: GET_ITEMS,\n          payload: res.data,\n        })\n      )\n      .catch(err => {\n        dispatch(returnErrors(err))\n        dispatch({ type: ITEMS_ERROR })\n      })\n  }\n}\n\n/**\n * A helper function to set a loading status.\n * Can be used for loading animations.\n */\nexport function setItemsLoading() {\n  return {\n    type: ITEMS_LOADING,\n  }\n}\n\n/**\n * A helper funciton to ensure added item status always starts falsy.\n */\nexport function setAddedItemsFalse() {\n  return {\n    type: ADD_ITEM_PRELOAD,\n  }\n}\n\n/**\n * Handle the addition of a new item.\n * @param {Object} item - The data of a new item.\n */\nexport function addItem(item) {\n  return (dispatch, getState) => {\n    const postUrl = api.createItem\n\n    return axios\n      .post(postUrl, item, headerConfig(getState))\n      .then(res => {\n        dispatch({\n          type: ADD_ITEM,\n          payload: res.data,\n        })\n      })\n      .catch(err => {\n        dispatch(returnErrors(err))\n      })\n  }\n}\n\n/**\n * Handle updating the data of an existing item.\n * @param {Object} item - The new updated data of the item.\n */\nexport function updateItem(item) {\n  return (dispatch, getState) => {\n    const putUrl = api.updateItem + item.id\n\n    return axios\n      .put(putUrl, item, headerConfig(getState))\n      .then(res => {\n        dispatch({\n          type: ADD_ITEM,\n          payload: res.data,\n        })\n      })\n      .catch(err => {\n        dispatch(returnErrors(err))\n      })\n  }\n}\n\n/**\n * Handle the deletion of an item.\n * @param {string} id - The id of an existing item.\n */\nexport function deleteItem(id) {\n  return (dispatch, getState) => {\n    const deleteUrl = api.deleteItem + id\n\n    return axios\n      .delete(deleteUrl, headerConfig(getState))\n      .then(res => {\n        dispatch({\n          type: DELETE_ITEM,\n          payload: id,\n        })\n      })\n      .catch(err => dispatch(returnErrors(err)))\n  }\n}\n</code></pre>\n<p>Item reducer:</p>\n<pre><code class=\"language-js\">import {\n  GET_ITEMS,\n  ADD_ITEM,\n  DELETE_ITEM,\n  ITEMS_LOADING,\n  ITEMS_ERROR,\n  ADD_ITEM_PRELOAD,\n} from \"../actions/actionTypes\"\n\nconst initialState = {\n  items: [],\n  isLoading: false,\n  addedItem: false,\n}\n\nexport default function itemReducer(state = initialState, action) {\n  switch (action.type) {\n    case GET_ITEMS:\n      return {\n        ...state,\n        items: action.payload.data,\n        isLoading: false,\n        addedItem: false,\n      }\n    case DELETE_ITEM:\n      return {\n        ...state,\n        items: state.items.filter(item => item._id !== action.payload),\n      }\n    case ADD_ITEM_PRELOAD:\n      return {\n        ...state,\n        addedItem: false,\n      }\n    case ADD_ITEM:\n      return {\n        ...state,\n        items: [action.payload, ...state.items],\n        isLoading: false,\n        addedItem: true,\n      }\n    case ITEMS_LOADING:\n      return {\n        ...state,\n        isLoading: true,\n      }\n    case ITEMS_ERROR:\n      return {\n        ...state,\n        isLoading: false,\n      }\n    default:\n      return state\n  }\n}\n</code></pre>\n<p>The components of the app were fairly straightforward, they included views for the following:</p>\n<ul>\n<li>Viewing all items</li>\n<li>Adding items (form)</li>\n<li>Deleting items</li>\n<li>Editing items (form)</li>\n<li>Login (form)</li>\n<li>Sign up/register (form)</li>\n</ul>\n<p>The views consisted of:</p>\n<ul>\n<li>A top navigation bar</li>\n<li>Main layout area</li>\n<li>Not found view</li>\n</ul>\n<p>All styles were custom and fully responsive (desktop/mobile). I took some inspiration from Google's Material Design for the colors and shapes.</p>\n<p>I performed minimal testing becuase I did not want to stray into implementation details and shallow rendering etc. I did just enough to ensure a component will redner without crashing.</p>\n<p>The finished app main page:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/859c83af98539e689c4222a0bd4ec1c1/29114/ReactRedux-MainView.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiUlEQVQoz5WS63KjMAyF8/6v10lCCRdjO7YxkLQ0TQMETiV16e52Nj/WM2dAkvXpYLw5v494eZ9gwgm5dtC+xTGeRfF8Qeh61Kc3OIpN6ODbV7jmRd6TwiAllTbi9XoXzga/1vnUoYk1rK7wvN8hIVWqlFzXROiqRPqcILij5IOzsKpA8B5NHVYMNsuyYCa1LU33AWWpcMgyZFmOPC8kF+oa2hgUZQnnPIyxCCHAWyO12DSY5xmE+XLI0K5joIfWGkVRiJRSkqupyRCwJCDH1lp4Alp/FHBDQGaIwz+B3JiRu/1+LzocDtIQYxRgnucCVFWFOnh4Op66jo+B3LwCkyRBmqYC4AZF7jh2zslXBAIeTSXDuraRY/sLyAXemBBsu91it9uJOMdQdssxO1WVgqOnp+HK0E+yHliBq9W+73G5XDCOI4Zh+BbHa22aJtxuN9EH6T4NMM0bnnSP1di3w0eLIdfrVXSf5of7lp8O+flTfBXYJTsSt8OIZV7+ufeLgd8X+9HE/619As/vRZYxfzHOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"React app main view\"\n        title=\"React app main view\"\n        src=\"/static/859c83af98539e689c4222a0bd4ec1c1/8c557/ReactRedux-MainView.png\"\n        srcset=\"/static/859c83af98539e689c4222a0bd4ec1c1/4edbd/ReactRedux-MainView.png 175w,\n/static/859c83af98539e689c4222a0bd4ec1c1/13ae7/ReactRedux-MainView.png 350w,\n/static/859c83af98539e689c4222a0bd4ec1c1/8c557/ReactRedux-MainView.png 700w,\n/static/859c83af98539e689c4222a0bd4ec1c1/e996b/ReactRedux-MainView.png 1050w,\n/static/859c83af98539e689c4222a0bd4ec1c1/2cefc/ReactRedux-MainView.png 1400w,\n/static/859c83af98539e689c4222a0bd4ec1c1/29114/ReactRedux-MainView.png 1920w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"date":"February 06, 2020","title":"React and Redux","tags":["JavaScript","Node.js","React","Redux"]}}},"pageContext":{"slug":"/blog/2020-02-06-React_and_Redux/","previous":{"fields":{"collection":"blog","slug":"/blog/2020-02-06-React_and_Redux/"},"frontmatter":{"title":"React and Redux"}},"next":{"fields":{"collection":"blog","slug":"/blog/2020-08-05-Gulp_Jekyll_Build_Tool/"},"frontmatter":{"title":"Gulp.js Jekyll Build Tool"}}}},"staticQueryHashes":["63159454"]}